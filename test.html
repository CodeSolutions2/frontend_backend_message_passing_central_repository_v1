<!DOCTYPE html>
<html>
<head></head>
<body>

<h1>Text encryption CRUD class library</h1>
There are five main functions of this text encryption class:
<ol type="A">
	<li>get decrypted file contents</li>
	<li>add data to file</li>
	<li>search file contents</li>
	<li>delete file contents</li>
	<li>encrypt text string</li>
</ol>

	
<input id="text_input" type="text" value="" placeholder="text_input" rows="10" cols="100" style="display:block; text-align: left; width: 150px;">

<div id="btns" class="buttonContainer">
  <button class="buttonClass" id="test0_get_decrypted_file_contents" type="button" style="display:block;" onclick="test0_get_decrypted_file_contents()">test0 get decrypted file contents</button>
	
  <button class="buttonClass" id="test1_add_data_to_file" type="button" style="display:block;" onclick="test1_add_data_to_file()">test1 add data to file</button>
  
  <button class="buttonClass" id="test2_search_file_contents" type="button" style="display:block;" onclick="test2_search_file_contents()">test2 search file contents</button>
  
  <button class="buttonClass" id="test3_delete_file_contents" type="button" style="display:block;" onclick="test3_delete_file_contents()">test3 delete file contents</button>
  
  <button class="buttonClass" id="test4_encrypt_text_string" type="button" style="display:block;" onclick="test4_encrypt_text_string()">test4 encrypt text string</button>
</div> 
  
<div id="notification"></div>
<div id="error"></div>
  
  <!-- --------------------------------------------------- -->

<script type="module">
import { encrypted_CRUD_file_storage } from "./library_encryption_class_ver1.js";
module.encrypted_CRUD_file_storage = encrypted_CRUD_file_storage;
</script>

<!-- --------------------------------------------------- -->

<!-- CSS -->
<style>
div { padding: 10px; display:block; font-family:courier; font-size:15px; height:300px; }
div#notification { position: relative; color: #3236a8; }
div#error { position: relative; color: #bd1f17; }

.buttonContainer { width: 75%; display: flex; flex-direction: row; justify-content: flex-start; flex-wrap: wrap; }
.buttonContainer > .buttonClass { width: 100px; height: 60px; font-size: 15px; text-wrap: wrap; }
</style>
	
<!-- --------------------------------------------------- -->
  
<script>

// ----------------------------------------------------
	
const module = {};

// ----------------------------------------------------

// Force the page to refresh the cached webpage
window.addEventListener('beforeunload', function() {
 	window.location.href = window.location.href + '?nocache=' + new Date().getTime();
});


// ----------------------------------------------------

async function initialize_variables() {

	document.getElementById('notification').innerHTML = '';
	document.getElementById('error').innerHTML = '';
		
	var RepoAobj = {};
	RepoAobj.repoOwner = 'CodeSolutions2';
	RepoAobj.repoA_name = 'frontend_backend_message_passing_central_repository_v1';
	RepoAobj.repoB_name = 'frontend_backend_message_passing_central_repository_v1';

	RepoAobj.filename = "cb_test.txt"; // filename to create in RepoB, in foldername
	RepoAobj.foldername = ''; // foldername in RepoB
	// if foldername='' it will try to save in https://api.github.com/repos/CodeSolutions2/frontend_backend_message_passing_central_repository_v1/contents//cb_test.txt
	
  	RepoAobj.input_text = document.getElementById("text_input").value+'|'+RepoAobj.repoA_name;
  
	RepoAobj.type_of_encryption = "window_crypto_subtle"; // "hexadecimal", "salt_scramble"
	
  	RepoAobj.append_text = "do_not_append_save_input_textOnly"; // "append_unique", "append_non_unique", "do_not_append_save_input_textOnly", "do_not_append_save_existing_textOnly"
  
	RepoAobj.NEW_publicKey_jwk = '';
	RepoAobj.pubpriv_keys_for_encryption = 'current'; // 'new', 'current'
	
	// Assign the class where input_text is the generated privateKey_jwk
	return new module.encrypted_CRUD_file_storage(RepoAobj);
}

// ----------------------------------------------------

async function test0_get_decrypted_file_contents() {

	const classObj = await initialize_variables();
	var obj = await classObj.get_decrypted_file_contents();

	document.getElementById('notification').innerHTML = obj.query_view_result + '. ' + obj.decrypted_file_contents;
}

// ----------------------------------------------------

async function test1_add_data_to_file() {
	
	const classObj = await initialize_variables();
	var obj = await classObj.add_data_to_file();

	document.getElementById('notification').innerHTML = obj.query_insert_result;
}

// ----------------------------------------------------

async function test2_search_file_contents() {

	const classObj = await initialize_variables();
	var obj = await classObj.search_file_contents();

	document.getElementById('notification').innerHTML = obj.query_search_result;
}
	
// ----------------------------------------------------

async function test3_delete_file_contents() {

	const classObj = await initialize_variables();
	var obj = await classObj.delete_file_contents();

	document.getElementById('notification').innerHTML = obj.query_delete_result;
}

// ----------------------------------------------------

async function test4_encrypt_text_string() {

	const classObj = await initialize_variables();
	var obj = await classObj.encrypt_text_string();

	document.getElementById('notification').innerHTML = obj.encrypted_file_contents;
}

// ----------------------------------------------------

</script>
</body>
</html>
